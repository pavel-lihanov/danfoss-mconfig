{% load i18n %}

<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
<script
  src="https://code.jquery.com/jquery-1.12.4.min.js"
  integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
  crossorigin="anonymous">
</script>
<script
  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
  crossorigin="anonymous">
</script>

<link rel="stylesheet" type="text/css" href="/mconfig/static/mconfig/files/style.css" />
<link rel="stylesheet" type="text/css" href="/mconfig/static/mconfig/files/mobile.css" />

<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body link="red">

<script type='text/javascript'>

function updateResult() {
	var f;
	if (this.readyState == 4 && this.status == 200) {						
		data = JSON.parse(this.responseText);
		if(data.package){
		updatePackage(data.package);} else {}
		if(data.price) {
		updatePrice(data.price);}	
		else { if (data.reason){ document.getElementById("reason").innerHTML=data.reason;} else {}}
		//updatePrice(data.reason)	;
		document.getElementById("err_panel").style.display="none";
	} else { 
		document.getElementById("err_panel").style.display="block";
		document.getElementById("err_text").innerHTML = "Server error";		
	}
	//document.getElementById("progress").innerHTML="Update done";
}

$( document ).ready(function() {
	//so we don't depend on templates to fill in the values
	var xhttp = new XMLHttpRequest();				
	xhttp.onreadystatechange = updateResult;

	xhttp.open('GET', 'refresh', true);
	xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');	
	xhttp.send();
});
</script>



<div class="error-msg">
	<div id="err_panel" class="w3-panel w3-orange w3-card-8" style="display:none;">
		<span class="w3-closebtn" onclick="this.parentElement.style.display='none'">X</span>
		<p id="err_text"><strong></strong></p>
	</div>
</div>
<div id="question">

<table border="0"> 
    <tr>
   	{% if not user.is_authenticated%} <th><a href="../../../login">Войти</a></th>{% endif %}
    <!--<th><a href="../../../create_user">Создать профайл</a></th>-->
	{% if  user.is_authenticated%}<th><a href="../../../logout">Выйти</a></th>{% endif %}
	{% if not user.is_authenticated%}<th><a href="../../../request_access">Отправить запрос на регистрацию</a></th>{% endif %}
	{% if user.is_authenticated%}<th> Пользователь: {{ user }} </th>{% endif %}
    </tr>
</table> 
	<h1>Конфигуратор высоковольтного привода</h1>

<div id="main_area">
	<div class="clear"></div>
	<div class="results">
			
			<h3>Результаты подбора</h3>
			<div>
				<p>
					<b>Тип преобразователя чистоты</b> <strong style="display:none;" id="package_name">{{question.packages.0.name}}</strong><br>
					<strong id="order_code">{{question.packages.0.order_code}}</strong>			
				</p>
				<p>
					<b>Краткое описание:</b> <small id="short_descr">{{question.packages.0.short_descr}}</small>
				</p>
			</div>
			
		<div id="price" style="display:none" >			
				<div id="price_details" >				
					<div id="supplier_price" ;>
					</div>
					
					<div id="delivery_cost">
					</div>
				</div>				
				<b>Партнерская цена:</b>
				<div id="sale_price" style="display:inline;">
					{{ package.price.sale_price }}
				</div>	

				<div class="btn-controls">
				<p>
					<div class="calc-btn">				 
					   <button id="savePdf" type="button" onclick="self.location='download/'">Ком.Пред.</button>				 				 
					   <button id="sendPdf" type="button" onclick="self.location='send_mail/'">Отправить на Email</button>				 
					</div>	
				</p>
				</div>

			

		</div>
		<div id="reason" >
		
		</div>
		<div id="tab">
		<div class="tab" >
		  <button class="tablinks" onclick="openCity(event, 'description')" id="defaultOpen">Описание</button>
		  <button class="tablinks" onclick="openCity(event, 'documentation')">Документация</button>
		</div>

		<div id="description" class="tabcontent">
		  <span onclick="this.parentElement.style.display='none'" class="topright">x</span>
			<p>
				{% for package in question.packages %}
					{% include package.template with package=package unpriced=False only %}
					<br>
				{% endfor %}
			</p>
		</div>

		<div id="documentation" class="tabcontent">
		  <span onclick="this.parentElement.style.display='none'" class="topright">x</span>

		  <p><a href="../../../static/VEDADRIVE_manual.pdf" download>Руководство по эксплуатации VEDADRIVE</a></p> 
		</div>
		</div>

	<script>
	function openCity(evt, cityName) {
		var i, tabcontent, tablinks;
		tabcontent = document.getElementsByClassName("tabcontent");
		for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		}
		tablinks = document.getElementsByClassName("tablinks");
		for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		}
		document.getElementById(cityName).style.display = "block";
		evt.currentTarget.className += " active";
	}

	// Get the element with id="defaultOpen" and click on it
	document.getElementById("defaultOpen").click();
	</script>
		<div class="btn-controls">	
        <form action="prev" id="prev_form" method="post" style="display: inline; float: left; padding: 10px;">
	    {% csrf_token %}
		
	    <button class="prev" type="button" id="prev_button" onclick="document.getElementById('prev_form').submit()">Назад</button>
		
        </form>	
		</div>
		<div class="clear"></div>

	</div>
	


</div>



</body>
